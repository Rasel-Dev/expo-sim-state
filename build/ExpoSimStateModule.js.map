{"version":3,"file":"ExpoSimStateModule.js","sourceRoot":"","sources":["../src/ExpoSimStateModule.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,mBAAmB,EAAE,MAAM,MAAM,CAAC;AAC3C,OAAO,EAAE,kBAAkB,EAAE,QAAQ,EAAE,MAAM,cAAc,CAAC;AAC5D,OAAO,EACL,iBAAiB,EACjB,mBAAmB,EACnB,uBAAuB,EACvB,wBAAwB,EACzB,MAAM,cAAc,CAAC;AA6CtB,+DAA+D;AAC/D,MAAM,YAAY,GAAG,mBAAmB,CAAC,cAAc,CAAC,CAAC;AAEzD;;;;;;;;;;;;;;;;;;;;;;;;GAwBG;AACH,MAAM,CAAC,KAAK,UAAU,WAAW;IAC/B,gDAAgD;IAChD,IAAI,QAAQ,CAAC,EAAE,KAAK,SAAS,EAAE,CAAC;QAC9B,MAAM,IAAI,wBAAwB,CAChC,gDAAgD,CACjD,CAAC;IACJ,CAAC;IAED,6DAA6D;IAC7D,MAAM,iBAAiB,GAAG,MAAM,iBAAiB,CAC/C,kBAAkB,CAAC,WAAW,CAAC,gBAAgB,CAChD,CAAC;IAEF,gEAAgE;IAChE,MAAM,kBAAkB,GAAG,MAAM,iBAAiB,CAChD,kBAAkB,CAAC,WAAW,CAAC,kBAAkB,EACjD;QACE,KAAK,EAAE,0BAA0B;QACjC,OAAO,EAAE,yEAAyE;QAClF,aAAa,EAAE,cAAc;QAC7B,cAAc,EAAE,QAAQ;QACxB,cAAc,EAAE,IAAI;KACrB,CACF,CAAC;IAEF,kEAAkE;IAClE,IAAI,CAAC,iBAAiB,IAAI,CAAC,kBAAkB,EAAE,CAAC;QAC9C,MAAM,IAAI,uBAAuB,CAC/B,uDAAuD,CACxD,CAAC;IACJ,CAAC;IAED,4CAA4C;IAC5C,IAAI,CAAC;QACH,MAAM,IAAI,GAAG,MAAM,YAAY,CAAC,WAAW,EAAE,CAAC;QAC9C,OAAO,IAAI,CAAC;IACd,CAAC;IAAC,OAAO,GAAQ,EAAE,CAAC;QAClB,yEAAyE;QACzE,MAAM,IAAI,mBAAmB,CAC3B,mCAAmC,MAAM,CAAC,GAAG,EAAE,OAAO,IAAI,GAAG,CAAC,EAAE,CACjE,CAAC;IACJ,CAAC;AACH,CAAC","sourcesContent":["import { requireNativeModule } from 'expo';\nimport { PermissionsAndroid, Platform } from 'react-native';\nimport {\n  requestPermission,\n  SimStateNativeError,\n  SimStatePermissionError,\n  SimStateUnsupportedError\n} from './Permission';\n\n/**\n * Represents a single SIM card on the device.\n * Contains all the relevant information needed for identification,\n * display in UI, or per-SIM operations such as sending SMS.\n */\nexport interface SimCardInfo {\n  /** Unique identifier for this SIM card in the device context. Maps to Android subscriptionId */\n  id: number;\n\n  /** The physical slot index where this SIM resides (0 = SIM1, 1 = SIM2, etc.) */\n  slotIndex: number;\n\n  /** The carrier name reported by the SIM (may be null on some carriers) */\n  carrierName: string | null;\n\n  /** Display name for UI purposes (e.g., \"SIM 1\", \"Work SIM\") */\n  displayName: string | null;\n\n  /** ISO 3166-1 country code of the SIM (e.g., 'us', 'bd') */\n  countryIso: string | null;\n\n  /** Phone number associated with the SIM. Often null due to carrier restrictions */\n  phoneNumber: string | null;\n\n  /** Whether the SIM is currently active and ready for use */\n  isReady: boolean;\n}\n\n/**\n * Represents the aggregated SIM state of the device.\n * Includes counts and details for all detected SIM cards.\n */\nexport interface SimStateResult {\n  /** Total number of SIM cards detected by the device */\n  simCount: number;\n\n  /** Number of SIM cards currently active and usable */\n  activeSimCount: number;\n\n  /** Array of detailed information about each SIM card */\n  simCards: SimCardInfo[];\n}\n\n/** Reference to the native Expo module for SIM state access */\nconst ExpoSimState = requireNativeModule('ExpoSimState');\n\n/**\n * Fetches the complete SIM state of the device in a DX-friendly manner.\n *\n * This function automatically handles:\n * - Android platform detection\n * - Required permissions checking and requesting\n * - Error handling with descriptive, typed errors\n *\n * Usage example:\n * ```ts\n * try {\n *   const simState = await getSimState();\n *   console.log(simState);\n * } catch (err) {\n *   if (err instanceof SimStatePermissionError) {\n *     // Handle missing permissions\n *   }\n * }\n * ```\n *\n * @throws {SimStateUnsupportedError} If the device is not running Android.\n * @throws {SimStatePermissionError} If the required permissions were denied by the user.\n * @throws {SimStateNativeError} If the native module failed to fetch SIM data.\n * @returns {Promise<SimStateResult>} Promise resolving to the device's SIM state.\n */\nexport async function getSimState(): Promise<SimStateResult> {\n  // Ensure the function is only called on Android\n  if (Platform.OS !== 'android') {\n    throw new SimStateUnsupportedError(\n      'SIM state is only available on Android devices'\n    );\n  }\n\n  // Request READ_PHONE_STATE permission to access SIM metadata\n  const phoneStateGranted = await requestPermission(\n    PermissionsAndroid.PERMISSIONS.READ_PHONE_STATE\n  );\n\n  // Request READ_PHONE_NUMBERS permission for phone number access\n  const phoneNumberGranted = await requestPermission(\n    PermissionsAndroid.PERMISSIONS.READ_PHONE_NUMBERS,\n    {\n      title: 'Phone Numbers Permission',\n      message: 'Your app needs access to your phone number for identification purposes.',\n      buttonNeutral: 'Ask Me Later',\n      buttonNegative: 'Cancel',\n      buttonPositive: 'OK'\n    }\n  );\n\n  // If any of the permissions are denied, throw a DX-friendly error\n  if (!phoneStateGranted || !phoneNumberGranted) {\n    throw new SimStatePermissionError(\n      'Required SIM permissions were not granted by the user'\n    );\n  }\n\n  // Call the native module to fetch SIM state\n  try {\n    const data = await ExpoSimState.getSimState();\n    return data;\n  } catch (err: any) {\n    // Wrap any native errors in a DX-friendly error with descriptive message\n    throw new SimStateNativeError(\n      `Native SIM state access failed: ${String(err?.message ?? err)}`\n    );\n  }\n}\n"]}